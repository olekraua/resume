<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Edit Certificates')}"></head>
<body class="resume">
<div th:replace="~{fragments/layout :: header}"></div>
<div class="layout-content l-container">
  <div th:replace="~{edit/_nav :: nav}"></div>
  <div class="c-panel c-panel--default certificates">
    <div class="c-panel__body">
      <h4 class="data-header">Сертификаты</h4>
      <hr />
      <form th:action="${appHost} + @{|/${profile.uid}/edit/certificates|}" method="post" th:object="${form}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div th:if="${#fields.hasErrors('*')}" class="c-alert c-alert--danger">
          <ul>
            <li th:each="err : ${#fields.errors('*')}" th:text="${err}">Error</li>
          </ul>
        </div>
        <div id="ui-block-container">
          <div th:each="cert,iter : *{items}" class="c-thumbnail ui-item" th:id="|ui-item-${iter.index}|">
            <input type="hidden" th:field="*{items[__${iter.index}__].smallUrl}"/>
            <input type="hidden" th:field="*{items[__${iter.index}__].largeUrl}"/>
            <button type="button" class="c-close" data-ui-remove>
              <span aria-hidden="true">&times;</span>
            </button>
            <a class="certificate-link" href="#"
               th:attr="data-title=${cert.name},data-url=${cert.largeUrl}">
              <img class="u-img-responsive" th:src="${cert.smallUrl}" th:alt="${cert.name}">
              <span th:text="${cert.name}">Certificate</span>
            </a>
            <div class="c-form__group">
              <input class="c-input c-input--sm" type="text" placeholder="Название"
                     th:field="*{items[__${iter.index}__].name}"/>
            </div>
            <div class="c-form__group">
              <input class="c-input c-input--sm" type="text" placeholder="Компания/организация"
                     th:field="*{items[__${iter.index}__].issuer}"/>
            </div>
          </div>
        </div>
        <hr />
        <div class="l-row">
          <div class="l-col l-col--xs-12">
            <a href="javascript:resume.certificates.showUploadDialog();">+ Добавить сертификат</a>
          </div>
        </div>
        <hr />
        <div class="l-row">
          <div class="l-col l-col--xs-12 u-text-center">
            <input type="submit" class="c-button c-button--primary" value="Сохранить">
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- template for ResumeTemplate -->
<script id="ui-block-template" type="text/x-resume-template">
  <div class="c-thumbnail ui-item" id="ui-item-{{blockIndex}}">
    <input type="hidden" name="items[{{blockIndex}}].smallUrl" value="{{smallUrl}}"/>
    <input type="hidden" name="items[{{blockIndex}}].largeUrl" value="{{largeUrl}}"/>
    <button type="button" class="c-close" data-ui-remove>
      <span aria-hidden="true">&times;</span>
    </button>
    <a class="certificate-link" href="#" data-title="{{name}}" data-url="{{largeUrl}}">
      <img class="u-img-responsive" src="{{smallUrl}}" alt="{{name}}">
      <span>{{name}}</span>
    </a>
    <div class="c-form__group">
      <input class="c-input c-input--sm" type="text" name="items[{{blockIndex}}].name" value="{{name}}"
             placeholder="Название"/>
    </div>
    <div class="c-form__group">
      <input class="c-input c-input--sm" type="text" name="items[{{blockIndex}}].issuer" value="{{issuer}}"
             placeholder="Компания/организация"/>
    </div>
  </div>
</script>

<!-- Certificate viewer modal -->
<div class="c-modal is-fade" id="certificateViewer" tabindex="-1" role="dialog">
  <div class="c-modal__dialog c-modal__dialog--lg">
    <div class="c-modal__content">
      <div class="c-modal__header">
        <button type="button" class="c-close" data-ui-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="c-modal__title">Certificate</h4>
      </div>
      <div class="c-modal__body u-text-center">
        <img class="u-img-responsive" src="#" alt="certificate">
      </div>
    </div>
  </div>
</div>

<!-- Certificate uploader modal -->
<div class="c-modal is-fade" id="certificateUploader" tabindex="-1" role="dialog" data-small-url="" data-large-url="">
  <div class="c-modal__dialog">
    <div class="c-modal__content">
      <div class="c-modal__header">
        <button type="button" class="c-close" data-ui-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="c-modal__title">Загрузить сертификат</h4>
      </div>
      <div class="c-modal__body">
        <div class="c-form__group">
          <label>Название</label>
          <input id="certificateName" class="c-input" type="text" placeholder="Название сертификата">
        </div>
        <div class="c-form__group">
          <label>Выдано</label>
          <input id="certificateIssuer" class="c-input" type="text" placeholder="Компания/организация">
        </div>
        <div class="c-form__group">
          <label>Файл</label>
          <div class="c-file" data-file-input>
            <input id="certificateFile" name="certificateFile" type="file" class="c-file__input" accept="image/*">
            <div class="c-file__group">
              <label class="c-button c-button--secondary c-file__button" for="certificateFile">Обрати файл</label>
              <div class="c-file__caption" data-file-caption>Файл не обрано</div>
              <button type="button" class="c-button c-button--secondary c-file__clear" data-file-clear>Очистити</button>
            </div>
            <div class="c-file__status" data-file-status></div>
          </div>
        </div>
      </div>
      <div class="c-modal__footer">
        <button type="button" class="c-button c-button--secondary" data-ui-dismiss="modal">Отмена</button>
        <button type="button" class="c-button c-button--primary" onclick="resume.certificates.add();">Добавить</button>
      </div>
    </div>
  </div>
</div>

<div th:replace="~{fragments/layout :: footer}"></div>
<th:block th:replace="~{fragments/layout :: scripts-base}"></th:block>
<th:block th:replace="~{fragments/layout :: scripts-edit}"></th:block>
<script th:inline="javascript">
  /*<![CDATA[*/
  resume.onReady(function () {
    resume.initCertificateViewer();
    var uploadUrl = /*[[@{|/${profile.uid}/edit/certificates/upload|}]]*/'';
    resume.createCertificateUploader(/*[[${_csrf.token}]]*/'', uploadUrl);
  });
  (function() {
    var form = document.querySelector('form');
    if (!form || !resume || !resume.ui || typeof resume.ui.normalizeListIndices !== 'function') return;
    form.addEventListener('submit', function() {
      resume.ui.normalizeListIndices('#ui-block-container', 'items');
    });
  })();
  /*]]>*/
</script>
</body>
</html>
