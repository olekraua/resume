<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Edit Skills')}"></head>
<body class="resume">
  <div th:replace="~{fragments/layout :: header}"></div>
  <div class="layout-content l-container">
    <h2>Технические навыки</h2>
    <div th:replace="~{edit/_nav :: nav}"></div>

  <div th:object="${form}">
    <div th:if="${#fields.hasErrors('*')}" class="c-alert c-alert--danger">
      <ul>
        <li th:each="err : ${#fields.errors('*')}" th:text="${err}">Error</li>
      </ul>
    </div>
  </div>

  <form th:action="${appHost} + @{|/${profile.uid}/edit/skills|}" method="post" th:object="${form}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <div id="ui-block-container">
      <div th:each="item,iter : *{items}" class="l-row ui-item skill-item" th:id="|ui-item-${iter.index}|">
        <div class="l-col l-col--xs-5 l-col--sm-4 l-col--md-2 c-form__group">
          <select class="c-input" th:field="*{items[__${iter.index}__].category}" required="required">
            <option value="" disabled="disabled" selected="selected">Выберите категорию</option>
            <option th:each="cat : ${skillCategories}" th:value="${cat.category}" th:text="${cat.category}">Category</option>
            <th:block th:if="${skillCategories == null or #lists.isEmpty(skillCategories)}">
              <option value="Languages">Languages</option>
              <option value="DBMS">DBMS</option>
              <option value="Web">Web</option>
              <option value="Java">Java</option>
              <option value="IDE">IDE</option>
              <option value="CVS">CVS</option>
              <option value="Web Servers">Web Servers</option>
              <option value="Build system">Build system</option>
              <option value="Cloud">Cloud</option>
              <option value="Frameworks">Frameworks</option>
              <option value="Tools">Tools</option>
              <option value="Testing">Testing</option>
              <option value="Other">Other</option>
            </th:block>
          </select>
        </div>
        <div class="l-col l-col--xs-7 l-col--sm-8 l-col--md-10 value-container">
          <button type="button" class="c-close" data-ui-remove>
            <span aria-hidden="true">&times;</span>
          </button>
          <textarea class="c-input u-pull-right" rows="2"
                    th:field="*{items[__${iter.index}__].value}" required="required"></textarea>
        </div>
      </div>
    </div>

    <div class="l-row" style="margin-bottom: 10px;">
      <div class="l-col l-col--xs-12">
        <a href="javascript:resume.ui.addBlock();">+ Добавить навык</a>
      </div>
    </div>

    <div class="l-row">
      <div class="l-col l-col--xs-12 u-text-center">
        <input type="submit" class="c-button c-button--primary" value="Сохранить">
      </div>
    </div>
  </form>
</div>
<div th:replace="~{fragments/layout :: footer}"></div>
<th:block th:replace="~{fragments/layout :: scripts-base}"></th:block>
<th:block th:replace="~{fragments/layout :: scripts-edit}"></th:block>

<script id="ui-block-template" type="text/x-resume-template">
  <div class="l-row ui-item skill-item" id="ui-item-{{blockIndex}}">
    <div class="l-col l-col--xs-5 l-col--sm-4 l-col--md-2 c-form__group">
      <select name="items[{{blockIndex}}].category" class="c-input" required="required">
        {{#each categories}}
        <option value="{{this}}">{{this}}</option>
        {{/each}}
      </select>
    </div>
    <div class="l-col l-col--xs-7 l-col--sm-8 l-col--md-10 value-container">
      <button type="button" class="c-close" data-ui-remove>
        <span aria-hidden="true">&times;</span>
      </button>
      <textarea name="items[{{blockIndex}}].value" class="c-input u-pull-right" rows="2" required="required"></textarea>
    </div>
  </div>
</script>
<script th:inline="javascript">
  /*<![CDATA[*/
  // expose categories to the template runtime
  window.skillCategories = /*[[${skillCategories.![category]}]]*/ [];
  resume.onReady(function() {
    if (!window.skillCategories || window.skillCategories.length === 0) {
      window.skillCategories = ["Languages", "DBMS", "Web", "Java", "IDE", "CVS",
        "Web Servers", "Build system", "Cloud", "Frameworks", "Tools", "Testing", "Other"];
    }
    // замінимо шаблон компіляції, щоб резюме.ui.addBlock бачило categories
    resume.ui.getTemplate = function() {
      if (resume.ui.template == null) {
        var source = document.getElementById('ui-block-template');
        resume.ui.template = source ? ResumeTemplate.compile(source.innerHTML) : null;
      }
      return resume.ui.template;
    };
    ResumeTemplate.registerHelper('categories', function() {
      return window.skillCategories;
    });
  });
  /*]]>*/
</script>
</body>
</html>
